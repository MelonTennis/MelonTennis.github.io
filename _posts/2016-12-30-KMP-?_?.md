---
layout: post
title: KMP ?_?
subtitle: KMP ä¸ªäººç†è§£
date: 2016-12-30
categories: DataStructure
tags: [KMP]
catalog: true
---

#### KMP (?_?)

ä»Šå¤©åšLC214. Shorest Palindrome, ç¬¬ä¸€æ¬¡æ¥è§¦KMPç®—æ³•ã€‚å€Ÿæ­¤æœºä¼šå­¦ä¹ ä¸€ä¸‹KMPç®—æ³•ã€‚ğŸ‘‡  ~~ç„¶åå‘ç°ä¸ç”¨KMPä¹Ÿèƒ½åš~~

> [KMP: å›¾çµç¤¾åŒº](http://www.ituring.com.cn/article/59881)
>
> [Wiki](https://en.wikipedia.org/wiki/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm)
>
> [GeeksforGeeks](<https://www.geeksforgeeks.org/kmp-algorithm-for-pattern-searching/>)

KMPç®—æ³•æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²åŒ¹é…çš„ç®—æ³•ï¼Œä¾‹å¦‚ï¼Œåœ¨S(S.length = n)ä¸²ä¸­å¯»æ‰¾P(P.length = m)ä¸²æ˜¯å¦å­˜åœ¨ã€‚æš´åŠ›çš„æ–¹æ³•å°±æ˜¯ä»¥Sçš„æ¯ä¸€ä½å­—ç¬¦ä¸ºèµ·å§‹å¼€å§‹åŒ¹é…Pï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…æˆåŠŸå°±åç§»ä¸€ä½ç›´åˆ°åŒ¹é…ç»“æŸã€‚è¿™æ ·çš„è¯å¤æ‚åº¦ä¸ºO(n*m)ã€‚æ€»è§‰å¾—ä¸å¤ªå¦™å•Š...KMPç®—æ³•èƒ½å¤Ÿé€šè¿‡å¯¹Pè¿›è¡Œé¢„å¤„ç†ä½¿ç®—æ³•å¤æ‚åº¦é™ä¸ºO(n + m) ~~å¥½å‰å®³â¤~~

> The basic idea behind KMPâ€™s algorithm is: whenever we detect a mismatch (after some matches), we already know some of the characters in the text of the next window. We take advantage of this information to avoid matching the characters that we know will anyway match. 

ä¸¾ä¸ªä¾‹å­å‡è®¾S = â€œATOBXATOBEKEIGOâ¤â€, P = "ATOBE" , ä»i = 0å¼€å§‹åŒ¹é…ï¼Œåˆ°i = 4æ—¶å¤±é…ï¼Œé‚£ä¹ˆæ„Ÿè§‰ä¸Šåº”è¯¥æ˜¯ä» i = 4å¼€å§‹åŒ¹é… j = 0ï¼Œ å¦‚æœS = â€˜ATATXBEATOBEKEIGOâ¤â€™ ï¼ŒP = 'ATATOBE', åœ¨i = 4å¤±é…ï¼Œæ„Ÿè§‰ä¸Šå°±åº”è¯¥ä» i = 4å¼€å§‹åŒ¹é… j = 2æ‰å¯¹ã€‚è¿™ç§æ„Ÿè§‰æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼ŸåŸæ¥æ˜¯å› ä¸ºPå­—ç¬¦ä¸²ä¸­è‡ªèº«çš„é‡å¤æ€§å¯¼è‡´çš„ã€‚æ‰€ä»¥é’ˆå¯¹Pçš„è‡ªèº«ç»“æ„è¿›è¡Œé¢„å¤„ç†å¾—åˆ°æ¨¡å¼å€¼æ•°ç»„([prefix function](<https://cp-algorithms.com/string/prefix-function.html>))ï¼Œå†æ ¹æ®æ¯æ¬¡å¤±é…çš„ä½ç½®å¯¹åº”æ­¤æ•°ç»„å†…çš„å€¼å°±å¯ä»¥å¾—åˆ°ä¸‹ä¸€ä¸ªå¼€å§‹è¿›è¡ŒåŒ¹é…çš„ä½ç½®(i, j)äº†ã€‚

#### æ¨¡å¼å€¼æ•°ç»„(Prefix Function)çš„æ±‚å–

ä¸€èˆ¬è¿™ä¸ªæ¨¡å¼å€¼æ•°ç»„å®šä¹‰ä¸ºnextï¼Œå…¶é•¿åº¦ä¸æ¨¡å¼Pä¸²ç›¸åŒã€‚nextæ•°ç»„æœ‰ä¸åŒçš„è¡¨ç¤ºæ–¹æ³•ï¼Œæˆ‘å°±~~å·æ‡’~~ç†è§£ä¸€ç§~~ä¼šç”¨å°±è¡Œå•¦~~ã€‚

>next[j] = -1:  åœ¨index = jå‰é¢å¹¶æ²¡æœ‰å’Œè‡ªèº«é‡å¤çš„å­åºåˆ—å‡ºç°
>
>next[j] = k (0 <= k < P.length): å­˜åœ¨[0 - k]åŒºåŸŸçš„På­åºåˆ—ï¼Œå…¶æœ«ä½åœ¨Pä¸­ä¸ºj(j != k)

ä¸¾å‡ ä¸ªğŸŒ°ï¼š

```
P = "ATATOBE" -> P.next = [-1, -1, 0, 1, -1, -1, -1]
P = "ATOBEAT" -> P.next = [-1, -1, -1, -1, -1, 0, 1]
P = "YYAOYYY" -> P.next = [-1, 0, -1, -1, 0, 1, 1]
```

ä»£ç å®ç°ï¼š

```java
public int[] getNext(String P){
  	int n = P.length();
  	char[] Parr = P.toCharArray();
  	int[] next = new int[n];
  	Arrays.fill(next, -1);
   
  	int i = 0, j = 1;  // ä»ç¬¬äºŒä½å¼€å§‹
  	for(; j < n; j++){
      	i = next[j-1]; // ä»ä¸Šä¸€ä½ç»§æ‰¿
      	while(Parr[i+1] != Parr[j] && i >= 0) i = next[i]; // éè¿ç»­çš„åŒ¹é…ä½ç½®, ä¾‹å¦‚ä¸Šé¢çš„ä¾‹3
      	if(Parr[i+1] == Parr[j]) next[j] = i + 1; // åŒ¹é…åˆ™åç§»ä¸€ä½
      	else next[j] = -1; // ä¸åŒ¹é…
  	}
  	return next;
}
```

#### åŒ¹é…

çœ‹èµ·æ¥ä¸é”™ï¼Œæ±‚å¾—äº†nextä¹‹åå°±å¯ä»¥åŒ¹é…äº†ï¼Œå½“å‘ç°P[j + 1]ä½ä¸åŒ¹é…ï¼Œåªè¦å›æº¯åˆ°P[next[j]+1]ä½å¼€å§‹åŒ¹é…ã€‚ä¾‹å¦‚S = â€œATATXBEATOBEKEIGOâ¤â€ï¼Œ P = â€œATATOBEâ€ï¼Œ åœ¨ i = 4å¤±é…ï¼Œè¿™é‡Œnext = [-1, -1, 0, 1, -1, -1, -1]ï¼Œ å› æ­¤åœ¨ä» i = 4å¼€å§‹å¯¹ j = 2å¼€å§‹åŒ¹é…ã€‚

ä»£ç å®ç°ï¼š

```java
public List<Integer> kmp(String S, String P){
  int[] next = getNext(P);
  int s = S.length(), p = P.length();
  int i = 0, j = -1;
  char[] sarr = S.toCharArray();
  char[] parr = P.toCharArray();
  List<Integer> match = new ArrayList<Integer>();
  for(i = 0; i < s; i++){
    // not match, go to next[j]
    while(parr[j + 1] != sarr[i] && j >= 0) j = next[j];	  
    // match, go to next char
    if(parr[j + 1] == sarr[i]) j++;
    // match, add to result and go to next
    if(j == p - 1){
      match.add(i - j);
      j = next[j];
    }
  } // for
  return match;
}
```

#### ç®—æ³•å¤æ‚åº¦

è£…æ¨¡ä½œæ ·çš„åˆ†æä¸€ç•ªå¤æ‚åº¦ã€‚getNextçš„å¤æ‚åº¦æ˜¯O(P.length),  å¯¹äºforå¾ªç¯ï¼Œå…¶ä¸­çš„whileå¾ªç¯æœ€å¤šå›æº¯jæ­¥ã€‚åœ¨æ•´ä¸ªå¯¹äºiçš„forå¾ªç¯ä¸­ï¼Œiçš„æœ€å¤§å¢é‡ä¸ºS.lengthï¼Œæ‰€ä»¥whileæœ€å¤šæ‰§è¡ŒS.lengthæ¬¡ã€‚forå¾ªç¯çš„å¤æ‚åº¦ä¸ºS.length. æ€»è€Œè¨€ä¹‹O(len1 + len2)ï¼Œæ¯”O(len1 * len2)æ„Ÿè§‰å¥½å¤šå•¦ã€‚




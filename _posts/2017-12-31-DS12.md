---
layout: post
title: Distributed System XII
subtitle: 15640 DS12 - Security
date: 2017-12-31
categories: Note
tags: [DS, 15640]
catalog: true
---

## Distributed System XII

æ‘¸ğŸŸçœŸå¯æ€•ï¼Œä¸çŸ¥ä¸è§‰å·²ç»2017çš„æœ€åä¸€å¤©äº†ã€‚æƒ³æƒ³æœç„¶æ²¡æœ‰ä»»ä½•åœ°æ–¹æ˜¯æ¯”è‡ªå·±å®¶é‡Œæ›´å¥½çš„å§ï½åœ¨å¤–é¢çš„æ—¶å€™å¿™èµ·æ¥éƒ½ä¸è§‰å¾—æœ‰ä»€ä¹ˆä½†æ˜¯å›åˆ°å®¶é‡Œå°±ä¼šè§‰å¾—ä¸€ç‚¹ä¹Ÿä¸æƒ³å»æƒ³åˆ«çš„äº‹æƒ…äº†åªæƒ³åœ¨å®¶å‘†ç€...å•Š æˆ‘è¦æŠŠå®ƒå†™å®Œ å¾ˆæ˜æ˜¾è¶Šæ¥è¶Šä¹±å†™å¯èƒ½è§‰å¾—å†™è¿™ä¸ªçš„æ—¶é—´è¿˜ä¸å¦‚å­¦ä¸€å­¦Databaseï¼Ÿæ„Ÿè§‰æ˜¯é ç€å¼ºè¿«ç—‡å‡‘ä¸ªæ•´æ¥åˆ°è¿™_(:Ğ·ã€âˆ )\_ å¯æ˜¯å­¦databaseå°±æœ‰ç”¨å—ï¼Ÿæˆ‘å·²ç»...

è¿™ä¸€ç¯‡DSæœ€åä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼ŒSercurity. ä¸»è¦è®²å®‰å…¨éšæ‚£ä¸ç½‘ç»œé€šä¿¡çš„å®‰å…¨æŠ€æœ¯ã€‚æ˜¯ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç‹¬ç«‹äºå…¶ä»–çŸ¥è¯†ç‚¹çš„ç§‘æ™®ã€‚

### Internet Security Weakness

* Anyone can connect
* Millions of hosts run nearly identical software
* Connection-less datagram service

**Need for secure communication**

* Authentication
* Confidentiality
* Integrity

**Some example of attack**:

Authenticity Attack - Fabrication

* Unauthorized assumption of other's identity
* Generate and distribute objects under this identity

<img src="https://raw.githubusercontent.com/YijiaJin/Plot/master/fabri.png" style="zoom:50%">

Integrity Attack - Tampering

* Stop the flow of the message
* Delay and optionally modify the message
* Release the message again

<img src="https://raw.githubusercontent.com/YijiaJin/Plot/master/tamper.png" style="zoom:50%">

Availability Attack 

* Destroy hardware (cutting fiber) or software
* Modify software in a subtle way
* Corrupt packets in transit

<img src="https://raw.githubusercontent.com/YijiaJin/Plot/master/dos.png" style="zoom:50%">

### Key Cryptography

#### Symmetric Key Crypto

Given a key k and a message m: Encryption (E), decryption (D)

* ciphertext c = E(k, m)
* plaintext m = D(k, c)

##### Symmetric Key: Confidentiality

Scheme: You send her the xor(M,K) and then they â€œdecryptâ€ using xor(M,K) again.

Problem: One-time Pad (OTP) is secure but usually impractical

Solution: Stream Ciphers, Block Ciphers

##### Symmetric Key: Integrity

Background: Hash Function Properties

* Consistent: hash(X) always yields same result
* One-way: given X, canâ€™t find Y s.t. hash(Y) = X
* Collision resistant: given hash(W) = Z, canâ€™t find X such that hash(X) = Z

Solution: HMAC

**Hash Message Authentication Code (HMAC)**:

<img src="https://raw.githubusercontent.com/YijiaJin/Plot/master/hmac.png" style="zoom:50%">

##### Symmetric Key: Authentication

Solution: HMAC + Nonce

åŒæ–¹äº‹å…ˆçº¦å®škeyå¹¶å‘é€æŒ‡å®šæ–‡ä»¶ç¡®è®¤èº«ä»½(HMAC)ã€‚ä½†æ˜¯ç›¸åŒçš„messageå¯èƒ½ä¼šè¢«è·å–å¹¶è½¬å‘ï¼Œè¿™æ ·æ”»å‡»è€…ä¸éœ€è¦çŸ¥é“keyå°±å¯ä»¥å‘é€ç¡®è®¤èº«ä»½çš„æ¶ˆæ¯ã€‚è§£å†³æ–¹æ³•æ˜¯åŠ å…¥random nonceä½¿æ¯ä¸€æ¬¡Authenticatoinçš„æ¶ˆæ¯ä¸åŒ.

Random  nonce: A random bitstring used only once. Alice sends nonce to Bob as a â€œchallengeâ€. Bob Replies with â€œfreshâ€ MAC result.

<img src="https://raw.githubusercontent.com/YijiaJin/Plot/master/nonce.png" style="zoom:50%">

#### Asymmetric Key Crypto

éåŒæ­¥çš„ï¼ŒåŒæ–¹äº‹å…ˆæ²¡æœ‰shareä»»ä½•keyã€‚

* Instead of shared keys, each person has a key pair: public key K, private key K<sup>-1</sup> 
* The keys are inverses: K<sup>-1</sup>(K(m)) = m

Given a key k and a message m: Encryption (E), decryption (D)

* ciphertext c = E(K, m)
* plaintext m = D(K<sup>-1</sup> , c)

##### Asymmetric Key: Confidentiality

Encrypt with Public Key of Receiver.

<img src="https://raw.githubusercontent.com/YijiaJin/Plot/master/aconf.png" style="zoom:50%">

##### Asymmetric Key: Sign & Verify

Sign message with private key of the sender.

Sign(M) = K<sup>-1</sup>(M) = Signature S

Verify (S, M) = test( K(S) == M )

Use Sign() and Verify() in a similar manner as HMAC in symmetric schemes.

<img src="https://raw.githubusercontent.com/YijiaJin/Plot/master/aauth.png" style="zoom:50%">

##### Asymmetric Key: Authentication

Entity being authenticated signs a nonce with private key, signature is then verified with the public key.

#### Symmetric Vs Asymmetric

<img src="https://raw.githubusercontent.com/YijiaJin/Plot/master/svsa.png" style="zoom:50%">

* Symmetric key primitives assumed sender and receiver had already shared a key. Â— 
* Asymmetric key primitives assumed sender knew receverâ€™s public key.

### Key Distribution

**Dreaded PKI**

PKI: Public Key Infrastructure 

* A system in which â€œroots of trustâ€ authoritatively bind public keys to real- world identities
* A significant stumbling block in deploying many â€œnext generationâ€ secure Internet protocol or applications.

**TLS aka SSL**

TLS: Transport Layer Security SSL: Secure Socket Layer

Special TLS socket layer between application and TCP.

Handles confidentiality, integrity, and authentication.

Uses â€œhybridâ€ cryptography.

#### Key Distribution Center (KDC)

Alice, Bob need shared symmetric key. Â— 

KDC: server shares different secret key with each registered user (many users).

Â—Alice, Bob know own symmetric keys, K<sub>A-KDC</sub>, K<sub>B-KDC</sub>, for communicating with KDC.

<img src="https://raw.githubusercontent.com/YijiaJin/Plot/master/kdc.png" style="zoom:50%">

* Must always be online to support secure communication
* KDC can expose our session keys to others!
* Centralized trust and point of failure.
* In practice, the KDC model is mostly used within single organizations.

#### Certification Authorities

Certification authority (CA): binds public key to particular entity, E.

An entity E registers its public key with CA: 

* E provides â€œproof of identityâ€ to CA.
* CA creates certificate binding E to its public key.
* Certificate contains Eâ€™s public key AND the CAâ€™s signature of Eâ€™s public key.

<img src="https://raw.githubusercontent.com/YijiaJin/Plot/master/ca.png" style="zoom:50%">

When Alice wants Bobâ€™s public key:

Gets Bobâ€™s certificate (Bob or elsewhere). Use CAâ€™s public key to verify the signature within Bobâ€™s certificate, then accepts public key.

Â—Better scaling: CA must only sign once... no matter how many connections the server handles. If CA is compromised, attacker can trick clients into thinking theyâ€™re the real server.

#### Forward secrecy

##### Diffie-Hellman Key Exchange

Different model of the world: How to generate keys between two people, securely, no trusted party, even if someone is listening in.

| Illustrative Example                     | Diffie-Hellman Key Exchange              |
| ---------------------------------------- | ---------------------------------------- |
| <img src="https://raw.githubusercontent.com/YijiaJin/Plot/master/dhe1.png" style="zoom:50%"> | <img src="https://raw.githubusercontent.com/YijiaJin/Plot/master/dhe2.png" style="zoom:50%"> |

Vulnerable to man-in-the- middle attack. Attacker pair-wise negotiates keys with each of A and B and decrypts traffic in the middle. No authentication.

Hybrid solution: use diffie-hellman key exchange with HMAC + nonce.

3 parties DH:

A=g<sup>a</sup> mod p, B=g<sup>b</sup> mod p, C=g<sup>c</sup> mod p
Alice sends A to Bob, Bob sends B to Charlie, Charlie sends C to Alice. Alice computes SA as C<sup>a</sup> mod p = g<sup>ca</sup> mod p , Bob computes SB as A<sup>b</sup> mod p = g<sup>ab</sup>  mod p , Charlie computes SC as B<sup>c</sup> mod p = g<sup>bc</sup> mod p. Alice sends SA to Bob, Bob sends SB to Charlie, Charlie sends SC to Alice. Alice computes S as SC<sup>a</sup> mod p = g<sup>bca</sup> mod p, Bob computes S as SA<sup>b</sup> mod p = g<sup>cab</sup> mod p, Charlie computes S as SB<sup>c</sup> mod p = g<sup>abc</sup> mod p. Only A, B, C, SA, SB, SC, p, g are sent in the clear. There is not enough information to discover g<sup>abc</sup> mod p using this information.

### Access control

#### Access Control Matrix (ACM)

A model of protection systems describes who (subject) can do what

(rights) to what/whom (object/subject).

<img src="https://raw.githubusercontent.com/YijiaJin/Plot/master/acm.png" style="zoom:50%">

ACLå’ŒCLæ˜¯ä¸ºäº†èŠ‚çœæ‰€å ç©ºé—´ã€‚

#### Access Control Lists

An ACL stores (non-empty elements of) each column with its object. With same structure, ACLS:

Â—file1: { (Andy, rx) (Betty, rwx) (Charlie, rx) } Â— 

file2: { (Andy, r) (Betty, r) (Charlie, rw) } Â— 

file3: { (Andy, rw) (Charlie, w) }

#### Capability Lists

C-Lists: what objects can subject acces, and how?

Andy: { (file1, rx) (file2, r) (file3, rw) } 

Betty: { (file1, rwx) (file2, r) } 

Charlie: { (file1, rx) (file2, rw) (file3, w) }

### Privacy and Tor

**Randomized Routing**

Hide message source by routing it randomly.

Routers donâ€™t know for sure if the apparent source of a message is the true sender or another router.

**Route Establishment**

Routing info for each link encrypted with routers public key Each router learns only the identity of the next router

**Tor**: second-generation onion routing network

* Client proxy establish a symmetric session key and circuit with Onion Router #1
* Client proxy extends the circuit by establishing a symmetric session key with Onion Router #2
* Client proxy extends the circuit by establishing a symmetric session key with Onion Router #3
* Client applications connect and communicate over the established Tor circuit



DSçš„æ‰€ä»¥è¯¾ä»¶ç¬”è®°éƒ½å†™å®Œäº†ã€‚è¶Šå†™åˆ°åé¢è¶Šä¸æ„¿æ„å†™äºæ˜¯è¶Šå†™è¶Šç³Ÿç³•ï¼Œè™½ç„¶æ˜æ˜æœŸä¸­è€ƒè¯•ä¹‹åçš„æ¯”è¾ƒä¼š...å°åœŸåˆ€å‰è¾ˆçœŸæ˜¯å‰å®³å¯ä»¥ä¸€ç›´åšæŒå†™è¿˜å¯ä»¥å†™çš„é‚£ä¹ˆå¥½âˆ ( á› ã€âˆ )ï¼¿ æ€»ä¹‹å› ä¸ºå¾ˆå–œæ¬¢DSçš„è®²å¸ˆDanielæ‰€ä»¥å†™äº†DSåœ¨è¿™ï¼Œè™½ç„¶ä¸ä¼šæœ‰äººçœ‹ä½†æ˜¯æƒ³è¦ç•™ä¸ªçºªå¿µå¸Œæœ›ä»¥åä¹Ÿèƒ½æƒ³èµ·å–œæ¬¢Danielå’Œå­¦ä¹ DSå¾ˆå¼€å¿ƒçš„å¿ƒæƒ…ã€‚è¯´åˆ°å–œæ¬¢Danielçš„ç†ç”±å˜›ï¼Œä¸Šè¯¾è®²ç¬‘è¯æ‰‹èˆè¶³è¹ˆï¼Œä¸‹è¯¾è·Ÿæˆ‘ä»¬èŠå¤©ï¼ŒOffice hourå»¶æ—¶ç­”ç–‘ï¼Œè®²é¢˜è¿˜çœ¨çœ¼çœŸæ˜¯è®©äººé­‚é£é­„æ•£å“¦(ç¬‘)ï¼Œå¤§å®¶éƒ½è®¤ä¸ºDanielå¾ˆæœ‰é­…åŠ›å•¦ã€‚æƒ³æƒ³DSå¯¹äºæ²¡æœ‰è¿™æ–¹é¢åŸºç¡€çš„æˆ‘æ¥è®²ç®—æ˜¯å¾ˆéš¾äº†ï¼Œå†™prjä¹Ÿæ˜¯ä¸¤ä¸ªç»„é˜Ÿprjä¸€ä¸ªè¢«é¸½soloå¦ä¸€ä¸ªå½“æ—¶é˜Ÿå‹å»onsiteæˆ‘åˆ·å¤œdebugï¼Œå•äººprjçš„è¯å°±æ„Ÿè°¢TAsè®©äººæ€è·¯æ¸…æ™°ã€‚å¯¹ä»»ä½•ä¸€é—¨è¯¾è€Œè¨€ï¼Œéš¾é“ä¸€å®šèƒ½ä¸Šå¥½å—ï¼Œä¸ä¾èµ–ä»–äººä¹Ÿä¸ç•æƒ§æç ¸å°±å·²ç»å¾ˆä¸é”™äº†å•Šâ¤ 



å‚è€ƒèµ„æ–™:

[Needham-schroeder](http://en.wikipedia.org/wiki/Needham-Schroeder_protocol) 

[Diffie-Hellman](http://en.wikipedia.org/wiki/Diffie-Hellman_key_exchange)



